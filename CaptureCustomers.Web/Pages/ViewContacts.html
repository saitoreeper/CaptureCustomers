<!DOCTYPE html>
<html>
<head>
    <title>View contacts</title>
    <meta charset="utf-8" />
    <link href="../Content/bootstrap.min.css" rel="stylesheet" />
</head>
<body>
    <div class="container">
        <div class="row">
            <div class="col-sm-6">
                <h2>Paul’s Training Company</h2>
            </div>
        </div>
    </div>
    <table id="productTable"
           class="table table-bordered
                 table-condensed table-striped">
        <thead>
            <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Contact Number</th>
            </tr>
        </thead>
    </table>



    <footer>
        <script src="../scripts/jquery-1.9.1.min.js"></script>
        <script src="../scripts/bootstrap.min.js"></script>
    </footer>

    <script>
        // Handle click event on Update button
        function updateClick() {
        }
        // Handle click event on Add button
        function addClick() {
        }

        $(document).ready(function () {
            contactsList();
        });

        function contactsList() {
            var url = window.location.href;
            var id = url.substring(0, "?");
            var equalsFind = url.indexOf("=");
            var id = url.substring(equalsFind + 1, url.length);
            alert(id);

            // Call Web API to get a list of contacts
            $.ajax({
                url: 'http://localhost:52734/api/contacts/' + id,
                type: 'GET',
                dataType: 'json',
                success: function (contacts) {
                    contactsListSuccess(contacts);
                },
                error: function (request, message, error) {
                    handleException(request, message, error);
                }
            });

            function contactsListSuccess(contacts) {
                var count = 0;
                // Iterate over the collection of data
                $.each(contacts, function (index, product) {
                    // Add a row to the Product table
                    contactsAddRow(contacts, count);
                    count = count + 1;
                });
            }

            function contactsAddRow(contacts, count) {
                // Check if <tbody> tag exists, add one if not
                if ($("#productTable tbody").length == 0) {
                    $("#productTable").append("<tbody></tbody>");
                }
                // Append row to <table>
                $("#productTable tbody").append(
                  contactsBuildTableRow(contacts, count));
            }

            function contactsBuildTableRow(contacts, count) {
                var contact = contacts[count];
                var ret =
                  "<tr>" +
                   "<td>" + contact.Name + "</td>" +
                   "<td>" + contact.Email + "</td>"
                    + "<td>" + contact.ContactNumber + "</td>" +
                  "</tr>";
                return ret;
            }

            function handleException(request, message,
                         error) {
                var msg = "";
                msg += "Code: " + request.status + "\n";
                msg += "Text: " + request.statusText + "\n";
                if (request.responseJSON != null) {
                    msg += "Message" +
                        request.responseJSON.Message + "\n";
                }
                alert(msg);
            }
        }
    </script>
</body>
</html>
