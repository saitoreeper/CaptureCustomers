<!DOCTYPE html>
<html>
<head>
    <title>View customers</title>
    <meta charset="utf-8" />
    <link href="../Content/bootstrap.min.css" rel="stylesheet" />
    <link href="../Content/style.css" rel="stylesheet" />
    <link href="../Content/datatables.min.css" rel="stylesheet" />
</head>
<body class="skin-1">

    <div id="wrapper">

        <div class="wrapper wrapper-content">
            <div class="form-horizontal">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="ibox float-e-margins">
                            <div class="ibox-title">
                                <div class="row">
                                    <div class="col-sm-10 col-xs-6">
                                        <h5>Customers List</h5>
                                    </div>
                                    <div class="col-sm-2 col-xs-6">
                                        <a href="AddCustomer.html"><button class="btn-lg btn-info">Add Customer</button></a>
                                    </div>
                                </div>

                            </div>
                            <div class="ibox-content">
                                <table id="customerTable" width="100%" class="table table-striped table-bordered table-hover dataTables-example">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Latitude</th>
                                            <th>longitude</th>
                                            <th>Links</th>
                                        </tr>
                                    </thead>
                                </table>

                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <footer>
        <script src="../scripts/jquery-1.9.1.min.js"></script>
        <script src="../scripts/bootstrap.min.js"></script>
        <script src="../scripts/datatables.min.js"></script>
    </footer>

    <script>
        $(document).ready(function () {
            customersList();

            setTimeout(function () {
                $(document).ready(function () {

                    $('.dataTables-example').DataTable({
                        dom: '<"html5buttons"B>lTfgitp',
                        buttons: [
                            { extend: 'copy' },
                            { extend: 'csv' },
                            { extend: 'excel', title: 'All Campaigns' },
                            { extend: 'pdf', title: 'All Campaigns' },

                            {
                                extend: 'print',
                                customize: function (win) {
                                    $(win.document.body).addClass('white-bg');
                                    $(win.document.body).css('font-size', '10px');

                                    $(win.document.body).find('table')
                                        .addClass('compact')
                                        .css('font-size', 'inherit');
                                }
                            }
                        ],
                        "scrollX": true
                    });

                    var message = 'd';
                    if (message != 'd') {
                        swal({
                            title: "Success",
                            text: "d",
                            type: "success"
                        });
                    }
                });
            }, 1000);

           
        });

        function customersList() {
            // Call Web API to get a list of Customers
            $.ajax({
                url: 'http://localhost:52734/api/customers',
                type: 'GET',
                dataType: 'json',
                success: function (customers) {
                    customersListSuccess(customers);
                },
                error: function (request, message, error) {
                    handleException(request, message, error);
                }
            });

            function customersListSuccess(customers) {
                var count = 0;
                // Iterate over the collection of data
                $.each(customers, function (index, product) {
                    // Add a row to the Product table
                    customersAddRow(customers, count);
                    count = count + 1;
                });
            }

            function customersAddRow(customers, count) {
                // Check if <tbody> tag exists, add one if not
                if ($("#customerTable tbody").length == 0) {
                    $("#customerTable").append("<tbody></tbody>");
                }
                // Append row to <table>
                $("#customerTable tbody").append(
                  customersBuildTableRow(customers, count));
            }

            function customersBuildTableRow(customers, count) {
                var customer = customers[count];
                var ret =
                  "<tr>" +
                   "<td>" + customer.Name + "</td>" +
                   "<td>" + customer.Latitude + "</td>"
                    + "<td>" + customer.longitude + "</td>" +
                     "<td><a href=" + "ViewContacts.html?id=" + customer.ID + "><button class=" + "btn-primary" + ">View Contacts</button></a> <a href=" + "AddContacts.html?id=" + customer.ID + "><button class=" + "btn-primary" + ">Add Contacts</button></a></td>" +
                  "</tr>";
                return ret;

            }

            function handleException(request, message,
                         error) {
                var msg = "";
                msg += "Code: " + request.status + "\n";
                msg += "Text: " + request.statusText + "\n";
                if (request.responseJSON != null) {
                    msg += "Message" +
                        request.responseJSON.Message + "\n";
                }
            }
        }
    </script>
</body>
</html>
