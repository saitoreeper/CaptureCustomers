<!DOCTYPE html>
<html>
<head>
    <title>View contacts</title>
    <meta charset="utf-8" />
    <link href="../Content/bootstrap.min.css" rel="stylesheet" />
</head>
<body>
    <div class="container">
        <div class="row">
            <div class="col-sm-6">
                <h2>Paul’s Training Company</h2>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-6">
            <button type="button" id="addButton"
                    class="btn btn-primary"
                    onclick="addClick();">
                Add Product
            </button>
        </div>
    </div>

    <div class="row">
        <div class="col-sm-6">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    Product Information
                </div>
                <div class="panel-body">
                    <form action="" name="addContactForm">
                        <div class="form-group">
                            <label for="name">Name</label>
                            <input type="text" id="name" name="name" class="form-control" />
                        </div>
                        <div class="form-group">
                            <label for="latitude">Email</label>
                            <input type="text" id="email" name="email" class="form-control" />
                        </div>
                        <div class="form-group">
                            <label for="longitude">Contact Number</label>
                            <input type="text" id="contactNumber" name="contactNumber" class="form-control" />
                        </div>
                        <button type="submit" id="updateButton" onclick="addContactClick()" class="btn btn-primary">Add Contact</button>
                    </form>
                </div>
                <div class="panel-footer">
                    <div class="row">
                        <div class="col-xs-12">
                           
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <script src="../scripts/jquery-1.9.1.min.js"></script>
        <script src="../scripts/jquery.validate.min.js"></script>
        <script src="../scripts/bootstrap.min.js"></script>
    </footer>

    <script>
        // Initialize form validation on the contact form.
        $("form[name='addContactForm1']").validate({
            // Specify validation rules
            rules: {
                name: "required",
                email: {
                    required: true,
                    email: true
                },
                contactNumber: {
                    required: true,
                    minlength: 9,
                    maxlength: 15
                }
            },
            // Specify validation error messages
            messages: {
                name: "Please enter Contact name",
                email: "Please enter a valid email address",
                contactNumber: {
                    required: "Please enter a contact number",
                    minlength: "Your contact number cannot be less than 9 characters",
                    maxlength: "Your contact number cannot be less than 15 characters"
                }
            },
            // Make sure the form is submitted to the destination defined
            // in the "action" attribute of the form when valid
            submitHandler: function (form) {
                form.submit();
                addContactClick();
            }
        });

        var Contact = {
            Name: "",
            Email: "",
            ContactNumber: "",
            CustomerId: 0
        }

        function addContactClick() {
            // Build contact object from inputs
            Contact = new Object();
            Contact.Name = $("#name").val();
            Contact.Email = $("#email").val();
            Contact.ContactNumber = $("#contactNumber").val();

            var url = window.location.href;
            var id = url.substring(0, "?");
            var equalsFind = url.indexOf("=");
            var id = url.substring(equalsFind + 1, url.length);

            Contact.CustomerId = id;

            ContactAdd(Contact);
        }

        function ContactAdd(Contact) {


            // Post Contact object to web api
            $.ajax({
                url: "http://localhost:52734/api/Contacts",
                type: 'POST',
                contentType: "application/json;charset=utf-8",
                data: JSON.stringify(Contact),
                success: function (Contact) {
                    ContactAddSuccess(Contact);
                },
                error: function (request, message, error) {
                    handleException(request, message, error);
                }
            });
        }

        function ContactAddSuccess(product) {
            //On success redirect back to index page
            window.location.href = '/pages/Index.html'
        }

        function handleException(request, message,
             error) {
            var msg = "";
            msg += "Code: " + request.status + "\n";
            msg += "Text: " + request.statusText + "\n";
            if (request.responseJSON != null) {
                msg += "Message" +
                    request.responseJSON.Message + "\n";
            }
            alert(msg);
        }
    </script>
</body>
</html>
