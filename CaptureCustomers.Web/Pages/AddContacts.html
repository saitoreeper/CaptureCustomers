<!DOCTYPE html>
<html>
<head>
    <title>Add contacts</title>
    <meta charset="utf-8" />
    <link href="../Content/bootstrap.min.css" rel="stylesheet" />
    <link href="../Content/style.css" rel="stylesheet" />
</head>
<body class="skin-1">

    <div id="wrapper">
        <div class="wrapper wrapper-content">
            <div class="form-horizontal">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="ibox float-e-margins">
                            <div class="ibox-title">
                                <h5>Add Contact</h5>
                            </div>
                            <div class="ibox-content">
                                <form action="" name="addContactForm">
                                    <div class="form-group">
                                        <label class="control-label col-md-2" for="name">Name</label>
                                        <div class="col-md-10">
                                            <input class="form-control text-box single-line" id="name" name="name" type="text" />
                                            <span class="field-validation-valid text-danger" data-valmsg-for="name" data-valmsg-replace="true"></span>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label class="control-label col-md-2" for="email">Email</label>
                                        <div class="col-md-10">
                                            <input class="form-control text-box single-line" id="email" name="email" type="text" />
                                            <span class="field-validation-valid text-danger" data-valmsg-for="email" data-valmsg-replace="true"></span>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label class="control-label col-md-2" for="contactNumber">Contact Number</label>
                                        <div class="col-md-10">
                                            <input class="form-control text-box single-line" id="contactNumber" name="contactNumber" type="text" />
                                            <span class="field-validation-valid text-danger" data-valmsg-for="name" data-valmsg-replace="true"></span>
                                        </div>
                                    </div>

                                    <button type="submit" id="updateButton" class="btn btn-primary">Add Customer</button>
                                    <a href="Index.html"><button class="btn btn-primary">Back</button></a>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <script src="../scripts/jquery-1.9.1.min.js"></script>
        <script src="../scripts/jquery.validate.min.js"></script>
        <script src="../scripts/bootstrap.min.js"></script>
    </footer>

    <script>
        // Initialize form validation on the contact form.
        $("form[name='addContactForm']").validate({
            // Specify validation rules
            rules: {
                name: "required",
                email: {
                    required: true,
                    email: true
                },
                contactNumber: {
                    required: true,
                    minlength: 9,
                    maxlength: 15
                }
            },
            // Specify validation error messages
            messages: {
                name: "Please enter Contact name",
                email: "Please enter a valid email address",
                contactNumber: {
                    required: "Please enter a contact number",
                    minlength: "Your contact number cannot be less than 9 characters",
                    maxlength: "Your contact number cannot be less than 15 characters"
                }
            },
            // Make sure the form is submitted to the destination defined
            // in the "action" attribute of the form when valid
            submitHandler: function (form) {
                addContactClick();
            }
        });

        var Contact = {
            Name: "",
            Email: "",
            ContactNumber: "",
            CustomerId: 0
        }

        function addContactClick() {
            // Build contact object from inputs
            Contact = new Object();
            Contact.Name = $("#name").val();
            Contact.Email = $("#email").val();
            Contact.ContactNumber = $("#contactNumber").val();

            var url = window.location.href;
            var id = url.substring(0, "?");
            var equalsFind = url.indexOf("=");
            var id = url.substring(equalsFind + 1, url.length);

            Contact.CustomerId = id;

            ContactAdd(Contact);
        }

        function ContactAdd(Contact) {


            // Post Contact object to web api
            $.ajax({
                url: "http://localhost:52734/api/Contacts",
                type: 'POST',
                contentType: "application/json;charset=utf-8",
                data: JSON.stringify(Contact),
                success: function (Contact) {
                    ContactAddSuccess(Contact);
                },
                error: function (request, message, error) {
                    handleException(request, message, error);
                }
            });
        }

        function ContactAddSuccess(product) {
            //On success redirect back to index page
            window.location.href = '/pages/Index.html'
        }

        function handleException(request, message,
             error) {
            var msg = "";
            msg += "Code: " + request.status + "\n";
            msg += "Text: " + request.statusText + "\n";
            if (request.responseJSON != null) {
                msg += "Message" +
                    request.responseJSON.Message + "\n";
            }
        }
    </script>
</body>
</html>
