<!DOCTYPE html>
<html>
<head>
    <title>View contacts</title>
    <meta charset="utf-8" />
    <link href="../Content/bootstrap.min.css" rel="stylesheet" />
</head>
<body>
    <div class="container">
        <div class="row">
            <div class="col-sm-6">
                <h2>Paul’s Training Company</h2>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-6">
            <button type="button" id="addButton"
                    class="btn btn-primary"
                    onclick="addClick();">
                Add Product
            </button>
        </div>
    </div>

    <div class="row">
        <div class="col-sm-6">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    Product Information
                </div>
                <div class="panel-body">
                    <div class="form-group">
                        <label for="name">Name</label>
                        <input type="text" id="name"
                               class="form-control" />
                    </div>
                    <div class="form-group">
                        <label for="latitude">Latitude</label>
                        <input type="text" id="latitude" class="form-control" />
                    </div>
                    <div class="form-group">
                        <label for="longitude">Longitude</label>
                        <input type="text" id="longitude" class="form-control" />
                    </div>
                </div>
                <div class="panel-footer">
                    <div class="row">
                        <div class="col-xs-12">
                            <button type="button" id="updateButton"
                                    class="btn btn-primary"
                                    onclick="addCustomerClick();">
                                Add
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <script src="../scripts/jquery-1.9.1.min.js"></script>
        <script src="../scripts/bootstrap.min.js"></script>
    </footer>

    <script>
        var Customer = {
            Name: "",
            Latitude: "",
            longitude: ""
        }

        function addCustomerClick() {
            // Build customer object from inputs
            Customer = new Object();
            Customer.Name = $("#name").val();
            Customer.Latitude = $("#latitude").val();
            Customer.longitude = $("#longitude").val();

            customerAdd(Customer);
        }

        function customerAdd(customer) {
            var url = window.location.href;
            var id = url.substring(0, "?");
            var equalsFind = url.indexOf("=");
            var id = url.substring(equalsFind + 1, url.length);

            // Post customer object to web api
            $.ajax({
                url: "http://localhost:52734/api/contacts/" + id,
                type: 'POST',
                contentType:"application/json;charset=utf-8",
                data: JSON.stringify(customer),
                success: function (customer) {
                    customerAddSuccess(customer);
                },
                error: function (request, message, error) {
                    handleException(request, message, error);
                }
            });
        }

        function customerAddSuccess(product) {
            //On success redirect back to index page
            window.location.href = '/pages/Index.html'
        }

        function handleException(request, message,
             error) {
            var msg = "";
            msg += "Code: " + request.status + "\n";
            msg += "Text: " + request.statusText + "\n";
            if (request.responseJSON != null) {
                msg += "Message" +
                    request.responseJSON.Message + "\n";
            }
            alert(msg);
        }
    </script>

</body>
</html>
