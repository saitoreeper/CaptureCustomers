<!DOCTYPE html>
<html>
<head>
    <title>Add customers</title>
    <meta charset="utf-8" />
    <link href="../Content/bootstrap.min.css" rel="stylesheet" />
    <link href="../Content/style.css" rel="stylesheet" />
</head>
<body class="skin-1">

    <div id="wrapper">
        <div class="wrapper wrapper-content">
            <div class="form-horizontal">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="ibox float-e-margins">
                            <div class="ibox-title">
                                <h5>Add Customer</h5>
                            </div>
                            <div class="ibox-content">
                                <form action="" name="addCustomerForm">

                                    <div class="form-group">
                                        <label class="control-label col-md-2" for="name">Name</label>
                                        <div class="col-md-10">
                                            <input class="form-control text-box single-line" id="name" name="name" type="text" />
                                            <span class="field-validation-valid text-danger" data-valmsg-for="name" data-valmsg-replace="true"></span>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label class="control-label col-md-2" for="latitude">Latitude</label>
                                        <div class="col-md-10">
                                            <input class="form-control text-box single-line" id="latitude" name="latitude" type="text" />
                                            <span class="field-validation-valid text-danger" data-valmsg-for="latitude" data-valmsg-replace="true"></span>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label class="control-label col-md-2" for="longitude">Longitude</label>
                                        <div class="col-md-10">
                                            <input class="form-control text-box single-line" id="longitude" name="longitude" type="text" />
                                            <span class="field-validation-valid text-danger" data-valmsg-for="longitude" data-valmsg-replace="true"></span>
                                        </div>
                                    </div>


                                    <button type="submit" id="updateButton" class="btn btn-primary">Add Customer</button>
                                    <a href="Index.html"><button class="btn btn-primary">Back</button></a>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <script src="../scripts/jquery-1.9.1.min.js"></script>
        <script src="../scripts/jquery.validate.min.js"></script>
        <script src="../scripts/bootstrap.min.js"></script>
    </footer>

    <script>

        // Initialize form validation on the customer form.
        $("form[name='addCustomerForm']").validate({
            // Specify validation rules
            rules: {
                name: "required",
                latitude: "required",
                longitude: "required"
            },
            // Specify validation error messages
            messages: {
                name: "Please enter customer name",
                latitude: "Please enter latitude",
                longitude: "Please enter longitude"
            },
            // Make sure the form is submitted to the destination defined
            // in the "action" attribute of the form when valid
            submitHandler: function (form) {
                addCustomerClick();
                return false;
            }
        });


        var Customer = {
            Name: "",
            Latitude: "",
            longitude: ""
        }

        function addCustomerClick() {
            // Build customer object from inputs
            Customer = new Object();
            Customer.Name = $("#name").val();
            Customer.Latitude = $("#latitude").val();
            Customer.longitude = $("#longitude").val();

            customerAdd(Customer);
        }

        function customerAdd(customer) {

            // Post customer object to web api
            $.ajax({
                url: "http://localhost:52734/api/customers",
                type: 'POST',
                contentType: "application/json;charset=utf-8",
                data: JSON.stringify(customer),
                success: function (customer) {
                    customerAddSuccess(customer);
                },
                error: function (request, message, error) {
                    handleException(request, message, error);
                }
            });
        }

        function customerAddSuccess(product) {
            //On success redirect back to index page
            window.location.href = '/pages/Index.html'
        }

        function handleException(request, message,
             error) {
            var msg = "";
            msg += "Code: " + request.status + "\n";
            msg += "Text: " + request.statusText + "\n";
            if (request.responseJSON != null) {
                msg += "Message" +
                    request.responseJSON.Message + "\n";
            }
        }
    </script>

</body>

</html>
